<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alumnos</title>
  </head>
  <body>
    <h1>Formulario escuela</h1>
    <label for="nombre">Nombre: </label>
    <input type="text" name="nombre" id="nombre" />
    <label for="apellidos">Apellidos: </label>
    <input type="text" name="apellidos" id="apellidos" />
    <br /><label for="dni">DNI: </label>
    <input type="text" name="dni" id="dni" />
    <label for="edad">Edad</label>
    <input type="number" name="edad" id="edad" />
    <br /><label for="curso"></label>
    <select name="curso" id="curso"></select>
    <button type="button" id="carga_datos">Aceptar</button>
    <button type="button" id="renderiza_tabla">Obtener tabla de datos</button>
    <table id="tabla_alumnos" border="1"></table>
  </body>
  <script>
    class Alumno {
      constructor(nombre, apellidos, dni, edad, curso) {
        this.nombre = nombre;
        this.apellidos = apellidos;
        this.dni = Alumno.verifica_dni(dni);
        this.edad = Alumno.verifica_edad(edad);
        this.curso = curso;
      }

      static verifica_edad(edad) {
        edad = parseInt(edad);
        if (edad >= 18 && edad <= 120) {
          return edad;
        } else {
          throw new Error("La edad est치 fuera del rango");
        }
      }

      static verifica_dni(dni) {
        dni = dni.toUpperCase();
        const expresion = new RegExp("^\\d{8}[A-Z]$");
        if (expresion.test(dni)) {
          return dni;
        } else {
          throw new Error("El DNI no es correcto");
        }
      }
      static cursos = ["1", "2", "3", "4", "5"];
      static poblar_cursos() {
        const selectCurso = document.getElementById("curso");
        Alumno.cursos.forEach((curso) => {
          const option = document.createElement("option");
          option.value = curso;
          option.textContent = curso;
          selectCurso.appendChild(option);
        });
      }
    }

    let lista_alumnos = JSON.parse(localStorage.getItem("lista_alumnos")) || [];

    const cargar_datos = function () {
      try {
        const nombre = document.getElementById("nombre").value;
        const apellidos = document.getElementById("apellidos").value;
        const dni = document.getElementById("dni").value;
        const edad = document.getElementById("edad").value;
        const curso = document.getElementById("curso").value;

        const alumno = new Alumno(nombre, apellidos, dni, edad, curso);
        console.log(alumno);
        lista_alumnos.push(alumno);
        localStorage.setItem("lista_alumnos", JSON.stringify(lista_alumnos));
      } catch (error) {
        window.alert(error.message);
        console.error(error);
      }
    };

    const crear_encabezado = function (claves) {
      const tabla = document.getElementById("tabla_alumnos");
      const encabezado = document.createElement("tr");
      claves.forEach((clave) => {
        const th = document.createElement("th");
        th.textContent = clave.charAt(0).toUpperCase() + clave.slice(1);
        encabezado.appendChild(th);
      });
      tabla.appendChild(encabezado);
    };

    const renderizar_tabla = function () {
      console.log(lista_alumnos);

      // Limpiar la tabla antes de renderizar
      const tabla = document.getElementById("tabla_alumnos");
      tabla.innerHTML = "";

      if (lista_alumnos.length === 0) {
        alert("No hay alumnos para mostrar.");
        return;
      }

      // Crear encabezado din치mico
      crear_encabezado(Object.keys(lista_alumnos[0]));

      // Crear filas din치micas
      lista_alumnos.forEach((alumno) => {
        let fila = document.createElement("tr");
        Object.values(alumno).forEach((valor) => {
          let celda = document.createElement("td");
          celda.textContent = valor;
          fila.appendChild(celda);
        });
        tabla.appendChild(fila);
      });
    };

    // Poblar los cursos al cargar la p치gina
    document.addEventListener("DOMContentLoaded", Alumno.poblar_cursos);

    document
      .getElementById("carga_datos")
      .addEventListener("click", cargar_datos);

    document
      .getElementById("renderiza_tabla")
      .addEventListener("click", renderizar_tabla);
  </script>
</html>
