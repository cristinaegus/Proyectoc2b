<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Tiempo en Bizkaia</title>
  </head>
  <body>
    <h1>El Tiempo en Bizkaia</h1>
    <h2>Estaciones meteorológicas</h2>
    <div>
      <label for="municipio">Selecciona un municipio:</label>
      <select id="municipio">
        <option value="48001">Bilbao</option>
        <option value="48002">Barakaldo</option>
        <option value="48003">Getxo</option>
        <option value="48004">Santurce</option>
        <option value="48005">Erandio</option>
        <!-- Agrega más municipios según sea necesario -->
      </select>
      <button id="cargar_datos">Cargar datos</button>
    </div>
    <div id="resultado">
      <h3>Datos de la estación</h3>
      <p>Selecciona un municipio y haz clic en "Cargar datos".</p>
    </div>
  </body>
  <script>
    const apiKey =
      "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJlZ3VzcXVpemFjcmlzdGluYUBnbWFpbC5jb20iLCJqdGkiOiIzOTZkYzc3MS1iZWVlLTQ2YmUtYjRkYi0yZGUxMjgxYWFmMjUiLCJpc3MiOiJBRU1FVCIsImlhdCI6MTc0NDc4ODAwOCwidXNlcklkIjoiMzk2ZGM3NzEtYmVlZS00NmJlLWI0ZGItMmRlMTI4MWFhZjI1Iiwicm9sZSI6IiJ9.lutTStfofioIu7kCnRlXmR2PvDluYPqlrHwDkBEWmMI";

    const cargarDatosBtn = document.getElementById("cargar_datos");
    const municipioSelect = document.getElementById("municipio");

    const cargarDatos = () => {
      const municipioId = municipioSelect.value;
      const url = `https://opendata.aemet.es/opendata/api/maestro/municipio/id48001/?api_key=${apiKey}`;

      fetch(url)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Error en la respuesta: " + response.status);
          }
          return response.json();
        })
        .then((data) => {
          console.log("Datos recibidos de la API:", data);
          return fetch(data.datos);
        })
        .then((response) => response.json())
        .then((estaciones) => {
          console.log("Estaciones:", estaciones);
          const resultadoDiv = document.getElementById("resultado");
          resultadoDiv.innerHTML = "";
          // convertir los datos de JSON a string
          console.log("Datos de la estación:", estaciones);

          // Crear una tabla para mostrar los datos
          const table = document.createElement("table");
          const headerRow = document.createElement("tr");
          const headers = [
            "Nombre",
            "Código",
            "Latitud",
            "Longitud",
            "Altitud",
            "Municipio",
          ];
          headers.forEach((header) => {
            const th = document.createElement("th");
            th.textContent = header;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);
          estaciones.forEach((estacion) => {
            const row = document.createElement("tr");
            const values = [
              estacion.nombre,
              estacion.codigo,
              estacion.latitud,
              estacion.longitud,
              estacion.altitud,
              estacion.municipio,
            ];
            values.forEach((value) => {
              const td = document.createElement("td");
              td.textContent = value;
              row.appendChild(td);
            });
            table.appendChild(row);
          });
          resultadoDiv.appendChild(table);
        });
    };

    cargarDatosBtn.addEventListener("click", cargarDatos);

    // Cargar datos al cargar la página
    document.addEventListener("DOMContentLoaded", () => {
      cargarDatos();
    });
  </script>
</html>
